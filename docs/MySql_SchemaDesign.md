# PharmaStock Database & Authentication Schema (MVP)

---

## Medications

- Id (Primary Key, int, auto-increment)
- Name (varchar(200), NOT NULL)
- NationalDrugCode (varchar(50), NULL)
- Form (tablet, capsule, gel, etc.) (varchar(50), NULL)
- Strength (varchar(50), NULL)
- Manufacturer (varchar(100), NULL)
- CreatedAtUtc (when it was added) (datetime, NOT NULL)
- UpdatedAtUtc (when it was adjusted) (datetime, NOT NULL)

---

## InventoryStocks

- Id (Primary Key, int, auto-increment)
- MedicationId (Foreign Key → Medications.Id, NOT NULL)
- QuantityOnHand (int, NOT NULL)
- ReorderLevel (int, NOT NULL)
- BinLocation (varchar(100), NULL) *(needed when we scale to multi-location)*
- LotNumber (varchar(100), NULL)
- ExpirationDate (datetime, NULL)
- BeyondUseDate (datetime, NULL)
- UpdatedAtUtc (datetime, NOT NULL)

---

## Core Relationship

**One Medication → Many InventoryStock records**

Example: *Ibuprofen 500mg*  
We can have multiple lots of the same medication in the system:

- Lot A: 50 tablets, expires 03/01/2026, stored in back room
- Lot B: 100 tablets, expires 06/01/2026, stored on shelf

So:
- **Medication** = the definition of the drug (ex: Ibuprofen 500mg)
- **InventoryStock** = the physical stock records (lots/batches/locations)

---

## Delete Behavior

**Cascade delete**  
If a Medication is deleted, all related InventoryStock rows will also be deleted automatically.

---

# Authentication

## Roles

This system has two primary user roles:

- **Admin**
- **Staff**

---

## Implementation

- ASP.NET Core Identity
- EF Core
- MySQL database
- JWT Bearer authentication

---

## Identity Tables (Auto-generated by ASP.NET Core Identity)

| Table Name         | Purpose |
|-------------------|---------|
| AspNetUsers        | Stores registered users |
| AspNetRoles        | Stores available roles (Admin, Staff) |
| AspNetUserRoles    | Many-to-many relationship between users and roles |
| AspNetUserClaims   | Additional claims per user |
| AspNetRoleClaims   | Claims associated with roles |
| AspNetUserLogins   | External login providers |
| AspNetUserTokens   | Security tokens |

---

## Role Permissions

### Admin
- Full system access
- Can manage medications
- Can manage inventory
- Can manage users
- Can assign roles

### Staff
- Can manage medications
- Can update inventory
- Cannot manage users
- Cannot access admin-only endpoints

---

## Authentication Flow

### Registration
1. User submits email + password
2. Identity validates password strength
3. User is stored in `AspNetUsers`
4. User is assigned a default role (**Staff**)

### Login
1. User submits email + password
2. Identity validates credentials
3. JWT is generated
4. Token includes:
   - UserId
   - Email
   - Role
   - Expiration timestamp (`exp`)

> Note: JWT expiration is stored in the token (`exp`), not in the database.

---

## JWT Configuration

JWT settings stored in `appsettings.json`:
- Issuer
- Audience
- Secret key
- Expiration time (60 minutes for MVP)

JWT will be validated via:
- Authentication middleware
- Role-based authorization attributes (example: `[Authorize(Roles = "Admin")]`)
